<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mini Chrome Tabs</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #f1f3f4;
  }

  /* タブバー */
  #tabs {
    display: flex;
    background: #dee1e6;
    padding: 6px;
    gap: 4px;
  }

  .tab {
    background: #e8eaed;
    padding: 6px 12px;
    border-radius: 8px 8px 0 0;
    cursor: pointer;
    font-size: 13px;
  }

  .tab.active {
    background: #ffffff;
  }

  #newTab {
    padding: 6px 10px;
    cursor: pointer;
    border-radius: 50%;
    background: #e8eaed;
  }

  /* アドレスバー */
  #toolbar {
    display: flex;
    gap: 8px;
    padding: 8px;
    background: #ffffff;
    border-bottom: 1px solid #ccc;
  }

  #address {
    flex: 1;
    padding: 8px;
    border-radius: 16px;
    border: 1px solid #ccc;
  }

  /* iframe */
  iframe {
    width: 100%;
    height: calc(100vh - 96px);
    border: none;
    display: none;
  }

  iframe.active {
    display: block;
  }
</style>
</head>

<body>

<!-- タブ -->
<div id="tabs">
  <div id="newTab">＋</div>
</div>

<!-- アドレスバー -->
<div id="toolbar">
  <input id="address" placeholder="https://example.com">
  <button onclick="go()">Go</button>
</div>

<!-- iframeたち -->
<div id="frames"></div>

<script>
  let tabs = [];
  let active = null;
  let tabId = 0;

  function createTab(url = "") {
    const id = tabId++;

    // tab UI
    const tab = document.createElement("div");
    tab.className = "tab";
    tab.textContent = "New Tab";
    tab.onclick = () => activateTab(id);
    tabs.push({ id, tab });

    document.getElementById("tabs").insertBefore(
      tab,
      document.getElementById("newTab")
    );

    // iframe
    const frame = document.createElement("iframe");
    frame.id = "frame-" + id;
    document.getElementById("frames").appendChild(frame);

    activateTab(id);

    if (url) {
      loadUrl(url);
    }
  }

  function activateTab(id) {
    active = id;

    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll("iframe").forEach(f => f.classList.remove("active"));

    const tabObj = tabs.find(t => t.id === id);
    tabObj.tab.classList.add("active");

    const frame = document.getElementById("frame-" + id);
    frame.classList.add("active");

    document.getElementById("address").value = frame.dataset.url || "";
  }

  function loadUrl(url) {
    if (!url.startsWith("http")) url = "https://" + url;

    const frame = document.getElementById("frame-" + active);
    frame.src = "/proxy?url=" + encodeURIComponent(url);
    frame.dataset.url = url;

    const tabObj = tabs.find(t => t.id === active);
    tabObj.tab.textContent = new URL(url).hostname;
  }

  function go() {
    if (active === null) createTab();
    loadUrl(document.getElementById("address").value);
  }

  document.getElementById("newTab").onclick = () => createTab();

  // 最初のタブ
  createTab("https://example.com");
</script>

</body>
</html>
